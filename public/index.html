<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Trust Fabric</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // --- The Single Source of Truth for Design Tokens ---
        const brandPalette = {
            gray: {
                50:  '#FAFAFA', // Near White
                400: '#A3A3A3', // Medium Gray
                600: '#525252', // Dark Gray
                700: '#3D3D3D', // Darker Gray
                800: '#2A2A2A', // Very Dark Gray
                900: '#1F1F1F', // Near Black
                950: '#111111', // True Black
            },
            green:  '#30E694',
            yellow: '#FFD60A',
            red:    '#F87171',
            white:  '#FFFFFF',
        };

        // Configure Tailwind to use the brandPalette
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-bg-primary':    brandPalette.gray[950],
                        'brand-bg-secondary':  brandPalette.gray[900],
                        'brand-bg-tertiary':   brandPalette.gray[800],
                        'brand-text-primary':  brandPalette.gray[50],
                        'brand-text-secondary':brandPalette.gray[400],
                        'brand-text-tertiary': brandPalette.gray[600],
                        'brand-border':        brandPalette.gray[700],
                        'brand-success':       brandPalette.green,
                        'brand-warning':       brandPalette.yellow,
                        'brand-error':         brandPalette.red,
                        'brand-accent':        brandPalette.white,
                    },
                    keyframes: { pulse: { '50%': { opacity: '.5' } } },
                    animation: { pulse: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
</head>
<body class="bg-brand-bg-primary text-brand-text-secondary">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import axios from 'https://esm.sh/axios@1.6.8';
        import { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ReferenceLine } from 'https://esm.sh/recharts@2.12.7?deps=react@18.2.0';

        const API_BASE_URL = 'http://127.0.0.1:8000';

        const SkeletonLoader = ({ className }) => React.createElement('div', { className: `animate-pulse bg-brand-bg-tertiary rounded-lg ${className}` });
        const Card = ({ children, className }) => React.createElement('div', { className: `bg-brand-bg-secondary rounded-lg p-6 border border-brand-border ${className}` }, children);
        const MetricCard = ({ title, value, valueClassName, subtitle }) => React.createElement(Card, {className: 'text-center'},
            React.createElement('h3', { className: 'text-sm font-bold text-brand-text-primary' }, title),
            React.createElement('p', { className: `text-4xl mt-2 ${valueClassName}` }, value),
            subtitle && React.createElement('p', { className: 'text-xs text-brand-text-tertiary mt-1' }, subtitle)
        );
        const CustomTooltip = ({ active, payload, label, isGpu }) => {
            if (active && payload && payload.length) {
                return React.createElement('div', { className: 'bg-brand-bg-secondary p-4 rounded-lg border border-brand-border shadow-lg' },
                    React.createElement('p', { className: 'text-sm text-brand-text-primary font-bold mb-2 text-center' }, isGpu ? `Batch Size: ${label}` : `Month: ${label}`),
                    payload.map((pld, index) => React.createElement('p', { key: index, style: { color: pld.fill || pld.stroke }, className: 'font-normal text-sm' },
                        `${pld.name}: ${isGpu ? '' : '$'}${pld.value.toLocaleString()}${isGpu ? ' ms' : ''}`
                    ))
                );
            }
            return null;
        };

        const IntegrityPanel = ({ data }) => {
            if (!data) return React.createElement('div', { className: 'space-y-6' }, React.createElement(SkeletonLoader, { className: 'h-32' }), React.createElement(SkeletonLoader, { className: 'h-48' }), React.createElement(SkeletonLoader, { className: 'h-48' }));
            if (data.error) return React.createElement(Card, {className:'border-brand-error'}, React.createElement('p', {className:'text-brand-error'}, data.error));
            
            const getAlertColorClass = (level) => ({ 'TARGET': 'text-brand-success', 'CAUTION': 'text-brand-warning', 'RISK': 'text-brand-error' }[level]);
            
            return React.createElement('div', { className: 'space-y-6' },
                React.createElement(Card, {className: 'text-center'},
                    React.createElement('h3', { className: 'font-bold text-brand-text-primary' }, 'Data Trust Index'),
                    React.createElement('p', { className: `text-6xl font-bold mt-2 ${getAlertColorClass(data.alert_level)}` }, `${data.integrity_score.toFixed(1)}%`),
                    React.createElement('p', { className: `font-semibold mt-2 ${getAlertColorClass(data.alert_level)}` }, data.alert_level)
                ),
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                    React.createElement(Card, {className: 'text-center'}, React.createElement('h3', { className: 'font-bold text-brand-text-primary' }, 'Completeness'), React.createElement('p', { className: 'italic text-sm text-brand-text-tertiary mt-1 mb-2' }, 'Percentage of non-missing values'), React.createElement('p', { className: 'text-3xl font-semibold' }, `${(data.missing_score * 100).toFixed(1)}%`)),
                    React.createElement(Card, {className: 'text-center'}, React.createElement('h3', { className: 'font-bold text-brand-text-primary' }, 'Consistency'), React.createElement('p', { className: 'italic text-sm text-brand-text-tertiary mt-1 mb-2' }, 'Adherence to schema and data types'), React.createElement('p', { className: 'text-3xl font-semibold' }, `${(data.schema_score * 100).toFixed(1)}%`)),
                    React.createElement(Card, {className: 'text-center'}, React.createElement('h3', { className: 'font-bold text-brand-text-primary' }, 'Uniqueness'), React.createElement('p', { className: 'italic text-sm text-brand-text-tertiary mt-1 mb-2' }, 'Percentage of non-duplicate records'), React.createElement('p', { className: 'text-3xl font-semibold' }, `${(data.duplicate_score * 100).toFixed(1)}%`)),
                    data.imbalance_score != null && React.createElement(Card, {className: 'text-center'}, React.createElement('h3', { className: 'font-bold text-brand-text-primary' }, 'Class Balance'), React.createElement('p', { className: 'italic text-sm text-brand-text-tertiary mt-1 mb-2' }, 'Distribution of the target variable'), React.createElement('p', { className: 'text-3xl font-semibold' }, `${(data.imbalance_score * 100).toFixed(1)}%`))
                ),
                React.createElement(Card, null,
                    React.createElement('h3', { className: 'text-lg font-bold text-brand-text-primary mb-4 text-center' }, 'Key Recommendations'),
                    React.createElement('ul', { className: 'list-disc list-inside space-y-2' }, data.recommendations.map((rec, i) => React.createElement('li', { key: i }, rec.endsWith('.') ? rec.slice(0, -1) : rec)))
                )
            );
        };
        
        const GPUPanel = ({ data }) => {
            if (!data) return React.createElement('div', { className: 'space-y-6' }, React.createElement(SkeletonLoader, { className: 'h-32' }), React.createElement(SkeletonLoader, { className: 'h-48' }), React.createElement(SkeletonLoader, { className: 'h-72' }));
            if (data.error) return React.createElement(Card, {className:'border-brand-error'}, React.createElement('p', {className:'text-brand-error'}, data.error));

            const formatChartData = (impactData) => Object.entries(impactData || {}).map(([key, value]) => ({ name: key, 'GPU Time (ms)': value }));
            const optimalBatch = data.recommendations.find(r => r.startsWith('Optimal'))?.split(': ')[1] || 'N/A';
            
            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'grid grid-cols-2 gap-6' },
                    React.createElement(MetricCard, { title: 'Potential Compute Savings', value: `${data.potential_savings_pct.toFixed(1)}%`, valueClassName: 'font-normal text-brand-text-primary' }),
                    React.createElement(MetricCard, { title: 'Optimal Batch Size', value: optimalBatch, valueClassName: 'font-normal text-brand-text-primary' })
                ),
                React.createElement(Card, null,
                    React.createElement('h3', { className: 'text-lg font-bold text-brand-text-primary mb-4 text-center' }, 'Key Recommendations'),
                    React.createElement('ul', { className: 'list-disc list-inside space-y-2' }, data.recommendations.map((rec, i) => React.createElement('li', { key: i }, rec.endsWith('.') ? rec.slice(0, -1) : rec)),
                    React.createElement('li', {className: 'mt-2 text-brand-text-secondary'}, `Why ${optimalBatch}? The analysis of training logs shows this batch size provides the best trade-off, minimizing GPU time for this model type.`)
                    )
                ),
                React.createElement(Card, null,
                    React.createElement('h3', { className: 'text-lg font-bold text-brand-text-primary mb-4 text-center' }, 'Impact of Batch Size on GPU Time'),
                     React.createElement(ResponsiveContainer, { width: '100%', height: 300 },
                        React.createElement(BarChart, { data: formatChartData(data.batch_size_impact) },
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: brandPalette.gray[700] }),
                            React.createElement(XAxis, { dataKey: 'name', stroke: brandPalette.gray[400] }),
                            React.createElement(YAxis, { stroke: brandPalette.gray[400] }),
                            React.createElement(Tooltip, { content: React.createElement(CustomTooltip, { isGpu: true }), wrapperStyle: { outline: 'none' }, cursor: { fill: brandPalette.gray[900] } }),
                            React.createElement(Bar, { dataKey: 'GPU Time (ms)', fill: brandPalette.white, fillOpacity: 0.8 })
                        )
                    )
                )
            );
        };
        
        const ROIPanel = ({ data }) => {
            if (!data) return React.createElement('div', { className: 'space-y-6' }, React.createElement(SkeletonLoader, { className: 'h-32' }), React.createElement(SkeletonLoader, { className: 'h-48' }), React.createElement(SkeletonLoader, { className: 'h-96' }));
            if (data.error) return React.createElement(Card, {className:'border-brand-error'}, React.createElement('p', {className:'text-brand-error'}, data.error));
            
            return React.createElement('div', { className: 'space-y-6' },
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                    React.createElement(MetricCard, { title: 'Retrain Decision Point', value: data.breach_period ? `month ${data.breach_period}` : 'Not Triggered', valueClassName: 'font-normal text-brand-text-primary' }),
                    React.createElement(MetricCard, { title: 'Total 12-Month Net Value', value: `$${Math.round(data.total_roi).toLocaleString()}`, valueClassName: `font-bold ${data.total_roi > 0 ? 'text-brand-success' : 'text-brand-error'}` })
                ),
                React.createElement(Card, {className: 'text-center'},
                    React.createElement('h3', { className: 'text-lg font-bold text-brand-text-primary mb-2' }, 'Reason for Trigger'),
                    React.createElement('p', { className: 'text-sm text-left' }, data.breach_period ? `The model's projected monthly net value dropped below the $6,000 retraining cost, indicating the cost of inaction now outweighs the cost of intervention.` : 'Performance remains economically viable.')
                ),
                React.createElement(Card, null,
                    React.createElement('h3', { className: 'text-lg font-bold text-brand-text-primary mb-4 text-center' }, 'Economic Impact of Model Decay'),
                     React.createElement(ResponsiveContainer, { width: '100%', height: 400 },
                        React.createElement(LineChart, { data: data.timeline, margin: { top: 20 } },
                            React.createElement(CartesianGrid, { strokeDasharray: '3 3', stroke: brandPalette.gray[700] }),
                            React.createElement(XAxis, { dataKey: 'period', stroke: brandPalette.gray[400] }),
                            React.createElement(YAxis, { stroke: brandPalette.gray[400], tickFormatter: (v) => `$${v/1000}k` }),
                            React.createElement(Tooltip, { content: React.createElement(CustomTooltip), wrapperStyle: { outline: 'none' }, cursor: { stroke: brandPalette.white, strokeDasharray: '3 3' } }),
                            React.createElement(Line, { type: 'monotone', dataKey: 'net_roi', name: 'Monthly Net Value', stroke: brandPalette.red, dot: false }),
                            React.createElement(Line, { type: 'monotone', dataKey: 'cum_roi', name: 'Cumulative Value', stroke: brandPalette.green, strokeWidth: 2, dot: false }),
                            data.breach_period && React.createElement(ReferenceLine, { x: data.breach_period, stroke: brandPalette.yellow, strokeDasharray: "3 3", label: { value: 'Trigger Point', position: 'insideTop', fill: brandPalette.yellow} })
                        )
                    )
                )
            );
        };
        
        function App() {
            const [activeTab, setActiveTab] = useState('integrity');
            const [integrityData, setIntegrityData] = useState(null);
            const [gpuData, setGpuData] = useState(null);
            const [roiData, setRoiData] = useState(null);

            const fetchAllData = async () => {
                const integrityPromise = axios.post(`${API_BASE_URL}/api/integrity/validate`, { records: [{age: 30, income: 50000, churn: "No"}, {age: 40, income: 60000, churn: "Yes"}, {age: null, income: 70000, churn: "No"}], target_col: "churn" }).catch(e => ({ data: { error: 'Failed to fetch data from API endpoint.' } }));
                const gpuPromise = axios.post(`${API_BASE_URL}/api/gpu/analyze`, { experiments: [ { "model_type": "LogisticRegression", "batch_size": 32, "epochs": 10, "gpu_time_ms": 55.1 }, { "model_type": "LogisticRegression", "batch_size": 64, "epochs": 10, "gpu_time_ms": 60.2 }, { "model_type": "LogisticRegression", "batch_size": 128, "epochs": 10, "gpu_time_ms": 70.3 }, { "model_type": "LogisticRegression", "batch_size": 256, "epochs": 10, "gpu_time_ms": 90.4 } ] }).catch(e => ({ data: { error: 'Failed to fetch data from API endpoint.' } }));
                const roiPromise = axios.post(`${API_BASE_URL}/api/roi/simulate`, {}).catch(e => ({ data: { error: 'Failed to fetch data from API endpoint.' } }));
                
                const [integrityResult, gpuResult, roiResult] = await Promise.all([integrityPromise, gpuPromise, roiPromise]);

                setIntegrityData(integrityResult.data);
                setGpuData(gpuResult.data);
                setRoiData(roiResult.data);
            };
            
            useEffect(() => {
                fetchAllData();
            }, []);

            const tabs = [ { id: 'integrity', label: 'Data Integrity' }, { id: 'gpu', label: 'GPU Efficiency' }, { id: 'roi', label: 'ROI Monitor' }];
            
            return React.createElement('div', { className: 'min-h-screen' },
                React.createElement('header', { className: 'bg-brand-bg-secondary border-b border-brand-border py-8 text-center' },
                    React.createElement('h1', { className: 'text-6xl font-bold text-brand-text-primary' }, 'AI Trust Fabric'),
                    React.createElement('p', { className: 'text-lg text-brand-text-secondary mt-2' }, 'Decision Integrity Platform'),
                    React.createElement('div', { className: 'mt-4 inline-flex items-center justify-center rounded-full border border-brand-success bg-brand-bg-secondary px-3 py-1 text-sm' },
                        React.createElement('span', { className: 'h-2 w-2 rounded-full bg-brand-success mr-2' }),
                        React.createElement('span', { className: 'text-brand-success' }, 'All Systems Operational')
                    )
                ),
                React.createElement('div', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8' },
                    React.createElement('div', { className: 'flex justify-center' },
                        React.createElement('nav', { className: 'flex space-x-2' },
                            tabs.map(tab => React.createElement('button', {
                                key: tab.id,
                                onClick: () => setActiveTab(tab.id),
                                className: `px-4 py-2 rounded-lg font-semibold text-sm transition-all duration-200 ${activeTab === tab.id ? 'bg-brand-accent text-brand-bg-primary' : 'bg-brand-bg-secondary text-brand-text-secondary hover:bg-brand-bg-tertiary'}`
                            }, tab.label))
                        )
                    )
                ),
                React.createElement('main', { className: 'max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8' },
                    activeTab === 'integrity' && React.createElement(IntegrityPanel, { data: integrityData }),
                    activeTab === 'gpu' && React.createElement(GPUPanel, { data: gpuData }),
                    activeTab === 'roi' && React.createElement(ROIPanel, { data: roiData })
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>